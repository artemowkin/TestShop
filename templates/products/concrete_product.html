{% extends 'base.html' %}
{% load cart_extras %}

{% block title %}TestShop | {{ product.title }}{% endblock %}

{% block content %}
<script defer>
    function addToCart() {
        fetch('/cart/add/{{ product.pk }}/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'}
        });
        let product_added_in_cart_message = document.querySelector(
            '.product_added_in_cart'
        );
        let product_add_to_cart_button = document.querySelector(
            '.product_add_to_cart'
        );
        product_add_to_cart_button.style.display = 'none';
        product_added_in_cart_message.style.display = 'block';
    }
</script>
<article class="concrete_product">
    <section class="concrete_product_info">
        <div class="concrete_product_images">
            {% for image in product.images.all %}
                {% if forloop.first %}
                    <img src="{{ image.image.url }}" alt="product image">
                {% endif %}
            {% endfor %}
        </div>
        <div class="concrete_product_right">
            <h1 class="concrete_product_title">{{ product.title }}</h1>
            <p class="concrete_product_price">{{ product.price }} $</p>
            <p class="concrete_product_short_description"><strong>Short description: </strong>{{ product.short_description }}</p>
            <p class="concrete_product_description"><strong>Description: </strong>{{ product.description }}</p>
            <p class="concrete_product_rating"><strong>Rating: </strong>{{ rating }}</p>
            {% if not product|is_in_cart:request %}
                <button type="button" class="product_add_to_cart" onclick="addToCart();">Add to cart</button>
                <p class="product_added_in_cart">Product added to cart</p>
            {% endif %}
        </div>
    </section>
    {% if similar_products %}
        <h2 class="similar_products_title">Similar products</h2>
    {% endif %}
    <aside class="similar_products">
        {% for similar_product in similar_products %}
            <a href="{{ similar_product.get_absolute_url }}" class="similar_product">
                {% for image in similar_product.images.all %}
                    {% if forloop.first %}
                        <img src="{{ image.image.url }}" alt="similar product image">
                    {% endif %}
                {% endfor %}
                <h3 class="similar_product_title">{{ similar_product.title }}</h3>
                <p class="similar_product_price">{{ similar_product.price }} $</p>
            </a>
        {% endfor %}
    </aside>
    <aside class="reviews">
        <form class="create_review_form">
            <p>Rating: <select class="create_review_rating">
                <option value="5">5</option>
                <option value="4">4</option>
                <option value="3">3</option>
                <option value="2">2</option>
                <option value="1">1</option>
            </select></p>
            <p class="create_review_text_field">Review: <textarea class="create_review_text"></textarea></p>
            <p><input type="submit" value="Create review" class="form_button create_review_button"></p>
        </form>
        {% for review in reviews %}
            <section class="review">
                <p class="review_user">{{ review.user }}</p>
                <p class="review_text">{{ review.text }}</p>
            </section>
        {% endfor %}
    </aside>
</article>
{% endblock %}
